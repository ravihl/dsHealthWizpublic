<template>
    <lightning-card title="API Usage Tracker" icon-name="utility:apex">
        <!-- KPI/Tile -->
        <div class="kpi-tile-container">
            <template if:true={summary}>
                <div class="kpi-tile">
                    <div class="kpi-label">Today Used</div>
                    <div class="kpi-value">{summary.callsUsed} / {summary.orgLimit}</div>
                    <div class="kpi-label">Used Quota:&nbsp;
                        <span class={usagePctClass}>{summary.usagePct}%</span>
                    </div>
                </div>
            </template>
            <template if:true={summaryError}>
                <div class="slds-text-color_error">Summary Error: {summaryErrorMessage}</div>
            </template>
        </div>

        <!-- Hourly Trend Table -->
        <div class="slds-m-top_small">
            <h3 class="slds-text-title_bold">Hourly Trend (Today)</h3>
            <template if:true={hourlyError}>
                <div class="slds-text-color_error">Hourly Data Error: {hourlyErrorMessage}</div>
            </template>
            <template if:true={hourly}>
                <lightning-datatable
                    key-field="hour"
                    data={hourly}
                    columns={columnsHourly}
                    hide-checkbox-column>
                </lightning-datatable>
            </template>
        </div>

        <!-- By Integration Table -->
        <div class="slds-m-top_medium">
            <h3 class="slds-text-title_bold">Top Integration Consumers (Today)</h3>
            <template if:true={byIntegrationError}>
                <div class="slds-text-color_error">Leaderboard Error: {byIntegrationErrorMessage}</div>
            </template>
            <template if:true={byIntegration}>
                <lightning-datatable
                    key-field="client"
                    data={byIntegration}
                    columns={columnsIntegration}
                    hide-checkbox-column>
                </lightning-datatable>
            </template>
        </div>
    </lightning-card>
</template>
